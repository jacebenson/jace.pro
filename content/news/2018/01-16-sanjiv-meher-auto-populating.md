---
title: "Autopopulating and validating date fields"
date: 2018-01-15T06:34:05.000Z
authors: ["Sanjiv Meher"]
link: "https://community.servicenow.com/community?id=community_blog&sys_id=467c62e1dbd0dbc01dcaf3231f9619ad"
---
<p>This post covers few basic <strong>use cases related to dates</strong> mostly used in <strong>Service Catalog or Change Management</strong>.</p><p>I have seen a lot of questions in community, where we want to validate a date or we want to default a date field to a future date.</p><p>I have gathered few such scenarios and tried to provide solutions with the help of community answers and my experience.</p><p></p><p>Most of them are using GlideAjax and onChange Client Script.</p><p>If you want to perform validation while record submission as well, you should use them in an onSubmit Script.</p><p><strong>Note</strong>: While using them in an <strong>onSubmit script, use getXMLWait()</strong> instead of a callback function. Because an onSubmit will not wait for a callback since callbacks are asynchronous.</p><p>If you don't want to write another onSubmit script, you can <strong>set the field value blank when validation fails by using g_form.setValue('start_date','')</strong>, so that user must enter a another date.</p><p></p><p>All the client scripts are doing a GlideAjax call to a script include '<strong>DateTimeFunc</strong>'.   Make sure you set the <strong>UI Type to All</strong> in client script to make it work in <strong>Service Portal</strong>.</p><p>Following are the functions defined in the script include.</p><p></p><p>1. <strong>addTime</strong>: If you want to add time to your end date based on start date selection</p><p></p><p>2. <strong>addTimeSchedule</strong>: If you want to add time to your end date, but the end date shouldn't fall during weekends or off hours. The schedule must be there is cmn_schedule table.</p><p></p><p>3. <strong>ValidateLeadTime</strong>: If you want to validate a lead time. For example, most of the organizations wants a lead time of 2 weeks for a comprehensive change. So while submitting a change, requester should choose a planned start date which is after 2 weeks from today.</p><p></p><p>4. <strong>CompareDates</strong>: When you want to compare any two dates and find out which is greater</p><p></p><p>5. <strong>ValidateBlackOuts</strong>: When you want your request or change implementation date doesn't fall in a blackout window.</p><p></p><p>I will keep improving the script based on your feedback and suggestions and add any other use cases related to dates which are used frequently.</p><p></p><p><span style="font-size: 14pt;"><strong>Use Case 1: I want to set a default date</strong></span></p><p></p><p>Set default value of the variable (Catalog Item) or field (Table) to below.</p><p></p><p>Add 14 days to current date</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15158881438413961 jive_text_macro" data-renderedposition="676.6666870117188_8_1116_16" jivemacro_uid="_15158881438413961"><p>javascript:var cdt = new GlideDateTime();cdt.addDays(14);cdt.getDisplayValue();</p></pre><p></p><p>Set date to current date with time '12:00:00'</p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15159757167102713 jive_text_macro" data-renderedposition="734_8_1116_16" jivemacro_uid="_15159757167102713"><p>javascript:var cdt = new GlideDateTime();cdt.getDisplayValue().split(' ')[0] + ' 12:00:00';</p></pre><p></p><p><span style="font-size: 14pt;"><strong>Use Case 2: I want to set end date based on start date</strong></span></p><p></p><p>Script Type: Client Script</p><p>Type: OnChange</p><p>Variable/Field Name: start_date</p><p>UI Type: All</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15158892020296231 jive_macro_code jive_text_macro" data-renderedposition="922.6666870117188_8_1116_256" jivemacro_uid="_15158892020296231"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p>if (isLoading || newValue == '') {</p><p>return;</p><p>}</p><p></p><p>var ga = new GlideAjax('DateTimeFunc');</p><p>ga.addParam('sysparm_name', 'addTime');</p><p>ga.addParam('start_date', newValue);</p><p>ga.addParam('time_to_add', '86400'); // Add 24 hours</p><p>ga.getXML(getEndDate);</p><p>}</p><p></p><p>function getEndDate(response) {</p><p>var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>g_form.setValue('end_date',answer);</p><p>}</p></pre><p></p><p></p><p><span style="font-size: 14pt;"><strong>Use Case 2.1: I want to set end date based on a Schedule</strong></span></p><p></p><p>Script Type: Client Script</p><p>Type: OnChange</p><p>Variable/Field Name: start_date</p><p>UI Type: All</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_151589311920052 jive_text_macro" data-renderedposition="1372_8_1116_304" jivemacro_uid="_151589311920052"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p>if (isLoading || newValue == '') {</p><p>return;</p><p>}</p><p></p><p></p><p>var ga = new GlideAjax('DateTimeFunc');</p><p>ga.addParam('sysparm_name', 'addTimeSchedule');</p><p>ga.addParam('start_date', newValue);</p><p>ga.addParam('time_to_add', '86400'); // Add 24 hours. If it is a 9*5 schedule (8 hrs per day), it will add 3 business days to start date</p><p>ga.addParam('schedule','<span style="color: rgba(0, 0, 0, 0); font-family: Consolas, 'Courier New', Courier, mono, serif; font-size: 12px;">8-5 weekdays</span>'); // You must have a record of the schedule in cmn_schedule table</p><p>ga.getXML(getEndDate);</p><p>}</p><p></p><p></p><p>function getEndDate(response) {</p><p>var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>g_form.setValue('end_date',answer);</p><p>}</p></pre><p></p><p><span style="font-size: 14pt;"><strong>Use Case 3: I want a Lead Time validation for date entered by requestor</strong></span></p><p></p><p>Script Type: Client Script</p><p>Type: OnChange</p><p>Variable/Field Name: start_date</p><p>UI Type: All</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_15158861901103492" data-renderedposition="1848.666748046875_8_1116_432" jivemacro_uid="_15158861901103492"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p>if (isLoading || newValue == '') {</p><p>return;</p><p>}</p><p>g_form.hideFieldMsg('start_date');</p><p>var start_date = g_form.getValue('start_date'); </p><p>var ajax = new GlideAjax('DateTimeFunc');</p><p>ajax.addParam('sysparm_name', 'ValidateLeadTime');</p><p>ajax.addParam('start_date', start_date);</p><p>ajax.getXML(validateDate);</p><p></p><p>}</p><p></p><p></p><p>function validateDate(response){</p><p>var answer = response.responseXML.documentElement.getAttribute("answer");</p><p></p><p>if (answer==1)</p><p>g_form.showFieldMsg('start_date',"The start date can't be in past",'error');</p><p>else if (answer==2)</p><p>g_form.showFieldMsg('start_date',"Please consider at least 2 weeks of lead time",'error');</p><p>}</p><p></p><p></p><p></p><p></p><p></p></pre><p></p><p></p><p><span style="font-size: 14pt;"><strong>Use Case 4: I want to Validate Start Date &lt; End Date</strong></span></p><p></p><p>Script Type: Client Script</p><p>Type: OnChange</p><p>Variable/Field Name: end_date</p><p>UI Type: All</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code _jivemacro_uid_15158927746626628 jive_text_macro" data-renderedposition="2474_8_1116_336" jivemacro_uid="_15158927746626628"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p></p><p>if (isLoading || newValue == '') {</p><p>return;</p><p>}</p><p>g_form.hideFieldMsg('end_date');</p><p>var ga = new GlideAjax('DateTimeFunc');</p><p>ga.addParam('sysparm_name', 'compareDates');</p><p>ga.addParam('start_date', g_form.getValue('start_date'));</p><p>ga.addParam('end_date', g_form.getValue('end_date'));</p><p>ga.getXML(getEndDate);</p><p>}</p><p></p><p></p><p>function getEndDate(response) {</p><p></p><p>var answer = response.responseXML.documentElement.getAttribute("answer");</p><p></p><p>if (answer=='true')</p><p>g_form.showFieldMsg('end_date','End date should be after start date','error');</p><p>}</p></pre><p></p><p><span style="font-size: 14pt;"><strong>Use Case 5: Date requested shouldn't fall in Blackout Windows</strong></span></p><p></p><p>Script Type: Client Script</p><p>Type: OnChange</p><p>Variable/Field Name: start_date</p><p>UI Type: All</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="_jivemacro_uid_15158926119235854 jive_macro_code jive_text_macro" data-renderedposition="2982.666748046875_8_1116_336" jivemacro_uid="_15158926119235854"><p>function onChange(control, oldValue, newValue, isLoading) {</p><p></p><p>if (isLoading || newValue == '') {</p><p>return;</p><p>}</p><p>g_form.hideFieldMsg('start_date');</p><p>var ga = new GlideAjax('DateTimeFunc');</p><p>ga.addParam('sysparm_name', 'ValidateBlackOuts');</p><p>ga.addParam('start_date', newValue); //Pass the date you want to validate</p><p>ga.getXML(isBlackout);</p><p></p><p>}</p><p></p><p></p><p>function isBlackout(response) {</p><p></p><p>var answer = response.responseXML.documentElement.getAttribute("answer");</p><p>if (answer=='true')</p><p>g_form.showFieldMsg('start_date','Please select a date outside blackout window','error');</p><p></p><p>}</p></pre><p></p><p></p><p></p><p><span style="font-size: 14pt;"><strong>Script Include</strong></span></p><p>Name : DateTimeFunc</p><p>Client Callable: true</p><p>Application: Global</p><p></p><pre __default_attr="javascript" __jive_macro_name="code" class="jive_macro_code jive_text_macro _jivemacro_uid_1515892532532382" data-renderedposition="3491.33349609375_8_1116_1888" jivemacro_uid="_1515892532532382"><p>var DateTimeFunc = Class.create();</p><p>DateTimeFunc.prototype = Object.extendsObject(AbstractAjaxProcessor, {</p><p></p><p></p><p>addTime: function() {</p><p>// Get the Start Date</p><p>var start = this.getParameter('start_date');</p><p>var timeToAdd = this.getParameter('time_to_add');</p><p>var gdt = new GlideDateTime();</p><p>gdt.setDisplayValue(start);</p><p></p><p></p><p>//add time to Start Date</p><p>gdt.addSeconds(timeToAdd); </p><p></p><p>//Return the End Date to Client Script</p><p>return gdt.getDisplayValue();</p><p>},</p><p></p><p></p><p>addTimeSchedule: function() {</p><p></p><p></p><p>var start = this.getParameter('start_date');</p><p>var timeToAdd = this.getParameter('time_to_add');</p><p><span style="color: rgba(0, 0, 0, 0); font-size: 12px; font-family: Consolas, 'Courier New', Courier, mono, serif;">var sch = this.getParameter('schedule');</span></p><p><span style="font-size: 9pt;">var gdt = new GlideDateTime();</span></p><p>gdt.setDisplayValue(start);</p><p></p><p></p><p>//Get a schedule by name to calculate duration</p><p>var schedRec = new GlideRecord('cmn_schedule');</p><p>schedRec.get('name', sch);</p><p>if (typeof GlideSchedule != 'undefined')</p><p>       var sched = new GlideSchedule(schedRec.sys_id);</p><p>else</p><p>       var sched = new Packages.com.glide.schedules.Schedule(schedRec.sys_id);</p><p></p><p></p><p>//Set the amount of time to add (in seconds)</p><p>durToAdd = new GlideDuration(timeToAdd*1000);</p><p>var newDateTime = sched.add(gdt, durToAdd, '');</p><p></p><p>//Return the new date</p><p>return newDateTime.getDisplayValue();</p><p>},</p><p></p><p></p><p>ValidateLeadTime: function() {</p><p>var se_start_date = this.getParameter('start_date');</p><p></p><p></p><p>var opened_date = gs.nowDateTime();</p><p></p><p>var currentDateTime = new GlideDateTime();</p><p>currentDateTime.setDisplayValue(opened_date);</p><p></p><p>var start_date = new GlideDateTime();</p><p>start_date.setDisplayValue(se_start_date);</p><p></p><p>if (se_start_date!='' &amp;&amp; start_date&lt;currentDateTime)</p><p>{</p><p>return 1; // Start Date Entered is in past</p><p>}</p><p>else if (se_start_date!='')</p><p>{</p><p>var dc = new DurationCalculator();</p><p></p><p>dc.setStartDateTime(currentDateTime);</p><p></p><p>if (!dc.calcDuration(14*24*3600))                       // Add 2 weeks</p><p>gs.log("*** Error calculating duration");</p><p></p><p>var newDateTime = dc.getEndDateTime();</p><p>if (start_date &lt; newDateTime)</p><p>{</p><p>return 2; // Date entered is within the 2 weeks of lead time</p><p>}</p><p>}</p><p>},</p><p></p><p></p><p>compareDates: function() {</p><p>var chg_start_date = this.getParameter('start_date');</p><p>var chg_end_date = this.getParameter('end_date');</p><p></p><p>if (chg_start_date &gt; chg_end_date)</p><p>{</p><p>return true;</p><p>}</p><p>return false;</p><p>},</p><p></p><p>ValidateBlackOuts: function() {</p><p></p><p></p><p>var ch_start_date = this.getParameter('start_date');</p><p>var start_date = new GlideDateTime();</p><p>start_date.setDisplayValue(ch_start_date);</p><p></p><p></p><p>var g = new GlideRecord('cmn_schedule');</p><p></p><p></p><p>var q = g.addQuery('name', 'Year-End Freeze');</p><p>q.addOrCondition('name','IT Infrastructure Blackouts');</p><p>g.query();</p><p></p><p></p><p>while (g.next()) {</p><p>var sched = new GlideSchedule(g.sys_id);</p><p>if (sched.isInSchedule(start_date)){</p><p>return true;</p><p>}</p><p>}</p><p>return false;</p><p>},</p><p>});</p></pre>